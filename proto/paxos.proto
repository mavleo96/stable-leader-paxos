syntax="proto3";

package pb;

import "google/protobuf/empty.proto";
import "google/protobuf/wrappers.proto";

option go_package = "github.com/mavleo96/stable-leader-paxos/pb";

service Paxos {
    rpc TransferRequest (TransactionRequest) returns (TransactionResponse);
    rpc PrepareRequest (PrepareMessage) returns (AckMessage);
    rpc NewViewRequest (NewViewMessage) returns (stream AcceptedMessage);
    rpc AcceptRequest (AcceptMessage) returns (AcceptedMessage);
    rpc CommitRequest (CommitMessage) returns (google.protobuf.Empty);
    rpc CatchupRequest (google.protobuf.Int64Value) returns (CatchupMessage);

    rpc ChangeNodeStatus (google.protobuf.BoolValue) returns (google.protobuf.Empty);
    rpc KillLeader (google.protobuf.Empty) returns (google.protobuf.Empty);

    rpc PrintLog (google.protobuf.Empty) returns (google.protobuf.Empty);
    rpc PrintDB (google.protobuf.Empty) returns (google.protobuf.Empty);
    rpc PrintStatus (google.protobuf.Int64Value) returns (google.protobuf.Empty);
    rpc PrintView (google.protobuf.Empty) returns (google.protobuf.Empty);
}

message BallotNumber {
    int64 n = 1;
    string nodeID = 2;
}

message AcceptRecord  {
    BallotNumber acceptedBallotNum = 1;
	int64 acceptedSequenceNum = 2;
    TransactionRequest acceptedVal = 3;
    bool Committed = 4;
    bool Executed = 5;
    bool Result = 6;
}

message PrepareMessage {
    BallotNumber b = 1;
}

message AckMessage {
    bool ok = 1;
    BallotNumber acceptNum = 2;
    repeated AcceptRecord acceptLog = 3;
}

message AcceptMessage {
    BallotNumber b = 1;
    int64 sequenceNum = 2;
    TransactionRequest message = 3;
}

message AcceptedMessage {
    bool ok = 1;
    BallotNumber b = 2;
    int64 sequenceNum = 3;
    TransactionRequest message = 4;
    string acceptorID = 5;
}

message NewViewMessage {
    BallotNumber b = 1;
    repeated AcceptRecord acceptLog = 2;
}

message CommitMessage {
    BallotNumber b = 1;
    int64 sequenceNum = 2;
    TransactionRequest transaction = 3;
}

message CatchupMessage {
    BallotNumber b = 1;
    repeated AcceptRecord acceptLog = 2;
}

message Transaction {
    string sender = 1;
    string receiver = 2;
    int64 amount = 3;
}

message TransactionRequest {
    Transaction transaction = 1;
    int64 timestamp = 2;
    string sender = 3;
}

message TransactionResponse {
    BallotNumber b = 1;
    int64 timestamp = 2;
    string sender = 3;
    bool result = 4;
}
